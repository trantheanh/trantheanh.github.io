---
title: "[ML â€“ 17] Neural Net Regularization with Drop-Out"
date: 2017-06-26
layout: post
comments: true
mathjax: true
---

ChÃ o cÃ¡c báº¡n, ráº¥t vui Ä‘Æ°á»£c gáº·p láº¡i cÃ¡c báº¡n trong bÃ i viáº¿t nÃ y. HÃ´m nay chÃºng ta sáº½ tÃ¬m hiá»ƒu vá» má»™t kÄ© thuáº­t Regularization cho ANN Ä‘Æ°á»£c gá»i lÃ  Drop-Out. Thay vÃ¬ Ä‘i vÃ o tÃ¬m hiá»ƒu â€œÄ‘áº¡o lÃ½â€ Ä‘áº±ng sau kÄ© thuáº­t nÃ y hay phÃ¢n phá»‘i xÃ¡c suáº¥t Ä‘áº±ng sau nÃ³, tÃ´i sáº½ giáº£i thÃ­ch má»™t cÃ¡ch trá»±c quan Ä‘á»ƒ cÃ¡c báº¡n dá»… hiá»ƒu, dá»… náº¯m báº¯t vÃ  mÆ°á»ng tÆ°á»£ng Ä‘Æ°á»£c Ã½ nghÄ©a cá»§a nÃ³.

## 1. Drop-Out lÃ  gÃ¬:

NhÆ° ta Ä‘Ã£ biáº¿t overfitting lÃ  má»™t váº¥n náº¡n Ä‘á»‘i vá»›i Machine Learning, Ä‘áº·c biá»‡t lÃ  trong máº¡ng NN. Khi muá»‘n cho mÃ´ hÃ¬nh trá»Ÿ nÃªn phá»©c táº¡p hÆ¡n, ta thÆ°á»ng tÄƒng sá»‘ lÆ°á»£ng layer vÃ  sá»‘ lÆ°á»£ng unit cá»§a má»—i layer thay vÃ¬ tÄƒng báº­c cá»§a feature nhÆ° trÆ°á»›c Ä‘Ã¢y Ä‘Ã£ Ä‘á» cáº­p. NhÆ°ng khi mÃ´ hÃ¬nh phá»©c táº¡p hÆ¡n, overfitting báº¯t Ä‘áº§u xuáº¥t hiá»‡n, vÃ¬ sá»‘ lÆ°á»£ng tham sá»‘ trong máº¡ng NN nhiá»u vÃ  cÃ³ â€œÄ‘á»™ sÃ¢uâ€ khÃ¡c nhau, vÃ¬ váº­y khi Ã¡p dá»¥ng chung ğº cho táº¥t cáº£ cÃ¡c tham sá»‘ sáº½ yÃªu cáº§u sá»‘ láº§n training lá»›n Ä‘á»ƒ tÃ¬m Ä‘Æ°á»£c ğº phÃ¹ há»£p. CÃ³ má»™t kÄ© thuáº­t dÃ nh riÃªng cho máº¡ng NN vÃ  khÃ¡ Ä‘Æ¡n giáº£n, Ä‘Ã³ lÃ  Drop-out (má»™t kÄ© thuáº­t khÃ¡c Ä‘Æ°á»£c biáº¿t Ä‘áº¿n tÆ°Æ¡ng tá»± lÃ  Drop-Connect).
Drop-out lÃ  má»™t kÄ© thuáº­t Regularization Ä‘á»ƒ chá»‘ng láº¡i váº¥n Ä‘á» overfitting. CÃ¡ch Drop-out thá»±c hiá»‡n lÃ  xoÃ¡ bá» má»™t sá»‘ unit trong cÃ¡c step training á»©ng vá»›i má»™t giÃ¡ trá»‹ xÃ¡c suáº¥t p cho trÆ°á»›c. 

<img src="/assets/content_images/ml17-01.png" alt = "" width = "100%">

## 2. Drop-Out hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o:


 Drop-Out Ä‘Æ°á»£c Ã¡p dá»¥ng trÃªn má»™t layer cá»§a máº¡ng NN vá»›i má»™t xÃ¡c suáº¥t p cho trÆ°á»›c (ta cÃ³ thá»ƒ sá»­ dá»¥ng nhiá»u Drop-Out khÃ¡c nhau cho nhá»¯ng layer khÃ¡c nhau, nhÆ°ng trÃªn 1 layer sáº½ chá»‰ cÃ³ 1 Drop-Out).
 Táº¡i má»—i step trong quÃ¡ trÃ¬nh training, khi thá»±c hiá»‡n Forward Propagation (Lan truyá»n xuÃ´i) Ä‘áº¿n layer sá»­ dá»¥ng Drop-Out, thay vÃ¬ tÃ­nh toÃ¡n táº¥t cáº£ unit cÃ³ trÃªn layer, táº¡i má»—i unit ta â€œgieo xÃºc xáº¯câ€ xem unit Ä‘Ã³ cÃ³ Ä‘Æ°á»£c tÃ­nh hay khÃ´ng dá»±a trÃªn xÃ¡c suáº¥t p. Vá»›i nhá»¯ng unit Ä‘Æ°á»£c tÃ­nh, ta tÃ­nh toÃ¡n bÃ¬nh thÆ°á»ng cÃ²n vá»›i nhá»¯ng unit khÃ´ng Ä‘Æ°á»£c tÃ­nh giÃ¡ trá»‹ táº¡i unit Ä‘Ã³ = 0.
 Khi thá»±c hiá»‡n tÃ­nh toÃ¡n trÃªn máº¡ng NN trong quÃ¡ trÃ¬nh test (sá»­ dá»¥ng máº¡ng NN Ä‘á»ƒ dá»± Ä‘oÃ¡n) thay vÃ¬ lÃ m nhÆ° trÃªn, ta thá»±c hiá»‡n tÃ­nh toÃ¡n trÃªn táº¥t cáº£ cÃ¡c unit nhÆ°ng trá»ng sá»‘ trÃªn má»—i connect Ä‘áº¿n cÃ¡c unit cá»§a layer Ä‘Æ°á»£c Ã¡p dá»¥ng Drop-Out Ä‘Æ°á»£c thay tháº¿ báº±ng giÃ¡ trá»‹ cá»§a trá»ng sá»‘ Ä‘Ã³ vá»›i xÃ¡c suáº¥t p hay \\(Î¸ := Î¸ * p\\)

## 3. Táº¡i sao Drop-Out hiá»‡u quáº£:

Äá»‘i vá»›i máº¡ng NN, khÃ´ng giá»‘ng nhÆ° nhá»¯ng kÄ© thuáº­t khÃ¡c nhÆ° **Linear Regression** hay **Logistic Regression** lÃ  Ä‘áº©y báº­c cá»§a feature lÃªn mÃ  ta tÄƒng sá»‘ lÆ°á»£ng hidden layer vÃ  sá»‘ lÆ°á»£ng unit trong cÃ¡c layer lÃªn. NhÆ°ng Ä‘á»‘i khi do viá»‡c thÃªm vÃ o quÃ¡ nhiá»u hidden layer cÅ©ng nhÆ° unit khiáº¿n cho mÃ´ hÃ¬nh phá»©c táº¡p hÆ¡n má»©c cáº§n thiáº¿t vÃ  khiáº¿n chÃºng bá»‹ overfitting. ChÃ­nh vÃ¬ váº­y Ä‘á»ƒ trÃ¡nh bá»‹ overfitting trong trÆ°á»ng há»£p nÃ y, ta cáº§n pháº£i giáº£n lÆ°á»£c máº¡ng NN hiá»‡n cÃ³. Khi Ã¡p dá»¥ng **Drop-Out** vÃ o 1 layer nÃ o Ä‘Ã³, thÃ¬ thá»±c táº¿ táº¡i má»—i training step máº¡ng NN cá»§a ta chá»‰ cÃ²n 1 pháº§n: 

<iframe width="560" height="315" src="https://www.youtube.com/embed/XkNjYME2dPg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>

Giáº£ sá»­ layer cá»§a ta cÃ³ 4 unit (nhÆ° trong clip minh hoáº¡), vÃ  xÃ¡c suáº¥t p = 0.8 -> khi Ä‘Ã³ xÃ¡c suáº¥t sá»­ dá»¥ng sá»‘ lÆ°á»£ng unit cá»§a layer sáº½ nhÆ° sau:

* Sá»­ dá»¥ng 0 unit cá»§a layer: \\
\\(= 1 * (1-p)^4 * p^0 = 0.2^4 * 0.8^0 = 0.0016 \\) \\
(VÃ¬ xÃ¡c suáº¥t Ä‘á»ƒ má»—i unit khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng lÃ  \\(1-p\\) nÃªn Ä‘á»ƒ cáº£ 4 unit khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng thÃ¬ xÃ¡c suáº¥t pháº£i lÃ  \\((1-p)^4\\) vÃ  chá»‰ cÃ³ \\(C_4^0\\) = 1 kháº£ nÄƒng chá»n ra 0 unit Ä‘Æ°á»£c sá»­ dá»¥ng)
* Sá»­ dá»¥ng 1 unit cá»§a layer:\\
\\(= 4 * p^1 * (1-p)^3 = 4 * 0.8^1 * 0.2^3 = 0.0256 \\)\\
(VÃ¬ xÃ¡c suáº¥t Ä‘á»ƒ má»—i unit khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng lÃ  \\(1-p\\) nÃªn Ä‘á»ƒ 3 unit khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng thÃ¬ xÃ¡c suáº¥t pháº£i lÃ  \\((1-p)^3\\) vÃ  cÃ³ thÃªm 1 unit Ä‘Æ°á»£c sá»­ dá»¥ng vá»›i xÃ¡c suáº¥t \\(p\\), bÃªn cáº¡nh Ä‘Ã³ cÃ³ tá»›i \\(C _{4} ^{1} = 4\\) unit cÃ³ thá»ƒ Ä‘Æ°á»£c chá»n Ä‘á»ƒ sá»­ dá»¥ng)
* TÆ°Æ¡ng tá»± khi sá»­ dá»¥ng 2 unit cá»§a layer:\\
\\(= 6 * p^2 * (1-p)^2 = 6 * 0.8^2 * 0.2^2 = 0.1536\\)\\
(cÃ³ \\(C_4^2 = 6\\) cÃ¡ch Ä‘á»ƒ lá»±a chá»n 2 unit Ä‘á»ƒ sá»­ dá»¥ng trong 4 unit cá»§a layer)
* Khi sá»­ dá»¥ng 3 unit cá»§a layer:\\
\\(= 4 * p^3 * (1-p)^1 = 4 * 0.8^3 * 0.2^1 = 0.4096 \\)\\
(cÃ³ \\(C_4^3 = 4\\) cÃ¡ch Ä‘á»ƒ lá»±a chá»n 3 unit Ä‘á»ƒ sá»­ dá»¥ng trong 4 unit cá»§a layer)
* Khi sá»­ dá»¥ng 4 unit cá»§a layer:\\
\\(= p^4 * (1-p)^0= 0.8^4 * 0.2^0 = 0.4096\\)\\
(chá»‰ cÃ³ \\(C_4^4 = 1\\) cÃ¡ch Ä‘á»ƒ lá»±a chá»n 4 unit Ä‘á»ƒ sá»­ dá»¥ng trong 4 unit cá»§a layer)

Táº¡i má»—i training step, ta sá»­ dá»¥ng máº¡ng vá»›i lÆ°á»£ng neuron khÃ¡c nhau, chÃ­nh vÃ¬ váº­y model cá»§a ta khÃ´ng thá»ƒ hoÃ n toÃ n "tin tÆ°á»Ÿng" vÃ o má»™t neuron nÃ o hay feature cá»¥ thá»ƒ nÃ o cá»§a layer Ä‘Ã³. ÄÃ¢y cÅ©ng lÃ  má»™t lÃ½ do Ä‘á»ƒ mÃ´ hÃ¬nh giáº£m thiá»ƒu viá»‡c bá»‹ overfit. BÃªn cáº¡nh Ä‘Ã³, vá»›i xÃ¡c suáº¥t p ta cÅ©ng cÃ³ Ä‘Æ°á»£c lÆ°á»£ng neuron trung bÃ¬nh cáº§n sá»­ dá»¥ng táº¡i layer nÃ y: 

\\[E(number \space of \space unit) = 0 * 0.0016 + 1 * 0.0256 + 2 * 0.1536 + 3 * 0.4096 + 4 * 0.4096 = 3.2 = 4 * 0.8 = 4 * p\\]

 (Sá»‘ lÆ°á»£ng unit nhÃ¢n vá»›i xÃ¡c suáº¥t \\(p\\)). NghÄ©a lÃ  khi Ã¡p dá»¥ng **Drop-Out** layer cá»§a ta chá»‰ sá»­ dá»¥ng sá»‘ unit tÆ°Æ¡ng Ä‘Æ°Æ¡ng \\(3.2\\) báº±ng cÃ¡ch sá»­ dá»¥ng nhiá»u máº¡ng nhá» (vá»›i 0,1,2,3,4 unit trong layer nhÆ° mÃ´ táº£ á»Ÿ trÃªn)
 CÃ³ 2 Ä‘iá»ƒm lá»£i khi ta sá»­ dá»¥ng **Drop-Out**:
 
* Vá»›i viá»‡c sá»­ dá»¥ng xÃ¡c suáº¥t p, lÆ°á»£ng unit báº¡n mong muá»‘n sá»­ dá»¥ng cÃ³ thá»ƒ tÃ¹y Ã½, khÃ´ng nháº¥t thiáº¿t pháº£i lÃ  sá»‘ tá»± nhiÃªn. Trong khi vá»›i viá»‡c thay Ä‘á»•i trá»±c tiáº¿p sá»‘ lÆ°á»£ng neuron, báº¡n chá»‰ cÃ³ thá»ƒ cÃ³ sá»‘ lÆ°á»£ng neuron lÃ  sá»‘ tá»± nhiÃªn.
* DÃ¹ tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i viá»‡c sá»­ dá»¥ng 3.2 unit nhÆ° á»Ÿ trÃªn, nhÆ°ng trong quÃ¡ trÃ¬nh training ta láº¡i sá»­ dá»¥ng xÃ¡c suáº¥t p Ä‘á»ƒ giá»¯ láº¡i cÃ¡c neuron nÃªn, model khÃ´ng thá»±c sá»± sá»­ dá»¥ng cá»¥ thá»ƒ má»™t lÆ°á»£ng unit nháº¥t Ä‘á»‹nh. Khi sá»‘ step training lá»›n, thá»±c táº¿ ta sá»­ dá»¥ng model vá»›i káº¿t quáº£ lÃ  trung bÃ¬nh cá»§a cÃ¡c máº¡ng con cÃ³ sá»‘ lÆ°á»£ng neuron tá»« 0 - 4 vÃ  vá»›i trá»ng sá»‘ lÃ  xÃ¡c suáº¥t nhÆ° Ä‘Ã£ mÃ´ táº£ á»Ÿ trÃªn. Äiá»u nÃ y cÅ©ng khÃ´ng thá»ƒ cÃ³ Ä‘Æ°á»£c khi báº¡n giáº£m trá»±c tiáº¿p lÆ°á»£ng unit cá»§a layer.  

Cuá»‘i cÃ¹ng, cÃ¡c báº¡n sáº½ tháº¯c máº¯c táº¡i sao khi sá»­ dá»¥ng máº¡ng NN Ä‘á»ƒ test ta láº¡i khÃ´ng â€œgieo xÃºc xáº¯câ€ nhÆ° khi training mÃ  láº¡i sá»­ dá»¥ng trá»ng sá»‘ cÃ³ giÃ¡ trá»‹ bá»‹ scale theo xÃ¡c suáº¥t p. 

Náº¿u muá»‘n thá»±c hiá»‡n tÆ°Æ¡ng tá»± nhÆ° quÃ¡ trÃ¬nh training, báº¡n sáº½ pháº£i thá»±c hiá»‡n predict "nhiá»u" láº§n, vÃ  láº¥y giÃ¡ trá»‹ trung bÃ¬nh cá»§a táº¥t cáº£ cÃ¡c láº§n predict Ä‘Ã³. Äiá»u nÃ y khiáº¿n cho há»‡ thá»‘ng cá»§a ta cháº­m Ä‘i nhiá»u láº§n, chÆ°a ká»ƒ Ä‘á»ƒ cÃ³ nhiá»u káº¿t quáº£ Ä‘á»§ Ä‘á»ƒ thá»ƒ hiá»‡n xÃ¡c suáº¥t p, sá»‘ láº§n thá»±c hiá»‡n sáº½ ráº¥t lá»›n. Váº­y bÃ¢y giá» pháº£i lÃ m nhÆ° tháº¿ nÃ o Ä‘á»ƒ chá»‰ pháº£i predict 1 láº§n, nhÆ°ng cho káº¿t quáº£ gáº§n Ä‘Ãºng nháº¥t. Giáº£ sá»­ nhÆ° ta thá»±c hiá»‡n predict nhiá»u láº§n, vÃ  cÃ³ 4 unit A,B,C,D tÆ°Æ¡ng á»©ng trá»ng sá»‘ W cá»§a chÃºng lÃ  \\(W_a, W_b, W_c, W_d\\). Giá» hÃ£y xem vá»›i 1 trá»ng sá»‘ cá»¥ thá»ƒ lÃ  Wa, nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng nhÆ° tháº¿ nÃ o! 

* XÃ¡c suáº¥t unit A Ä‘Æ°á»£c sá»­ dá»¥ng trong trÆ°á»ng há»£p cáº£ layer giá»¯ láº¡i cáº£ 4 unit lÃ  100%. XÃ¡c suáº¥t giá»¯ láº¡i 4 unit = 0.4096
* XÃ¡c suáº¥t unit A Ä‘Æ°á»£c sá»­ dá»¥ng trong trÆ°á»ng há»£p chá»‰ cÃ³ 3 unit Ä‘Æ°á»£c giá»¯ láº¡i lÃ  75%. XÃ¡c suáº¥t giá»¯ láº¡i 3 unit = 0.4096
* XÃ¡c suáº¥t unit A Ä‘Æ°á»£c sá»­ dá»¥ng trong trÆ°á»ng há»£p chá»‰ cÃ³ 2 unit Ä‘Æ°á»£c giá»¯ láº¡i lÃ  50%. XÃ¡c suáº¥t giá»¯ láº¡i 2 unit = 0.1536
* XÃ¡c suáº¥t unit A Ä‘Æ°á»£c sá»­ dá»¥ng trong trÆ°á»ng há»£p chá»‰ cÃ³ 1 unit Ä‘Æ°á»£c giá»¯ láº¡i lÃ  25%. XÃ¡c suáº¥t giá»¯ láº¡i 1 unit = 0.0256

=> \\( W_a ^T A \\) trÆ°á»›c kia sáº½ trá»Ÿ thÃ nh:
\\( 
= 0.4096 * 1 * W_a ^T A + 0.4096 * 0.75 * W_a ^T A + 0.1536 * 0.5 * W_a ^T A + 0.0256 * 0.25 * W_a ^T A 
\\)

\\( 
= 0.8 * W_a ^T A 
\\)

=> Ta pháº£i scale W theo 0.8 = p

Äáº¿n Ä‘Ã¢y chÃºng ta Ä‘Ã£ hiá»ƒu tÆ°á»ng táº­n **Drop-Out** rá»“i pháº£i khÃ´ng nÃ o :)