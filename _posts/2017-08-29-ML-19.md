---
title: "[ML â€“ 19] Convolution Neural Network â€“ Part 2"
date: 2017-08-29
layout: post
comments: true
mathjax: true
---

ChÃ o cÃ¡c báº¡n, hÃ´m nay chÃºng ta tiáº¿p tá»¥c tÃ¬m hiá»ƒu vá» máº¡ng neural tÃ­ch cháº­p (CNN). Trong bÃ i viáº¿t trÆ°á»›c, ta Ä‘Ã£ Ä‘Æ°á»£c biáº¿t vá» nhá»¯ng nhÆ°á»£c Ä‘iá»ƒm trong máº¡ng neural truyá»n thá»‘ng Ä‘á»“ng thá»i giá»›i thiá»‡u vá» CNN vÃ  Ä‘Ã£ cÃ³ Ä‘Æ°á»£c nhá»¯ng cÃ¡i nhÃ¬n Ä‘áº§u tiÃªn vá» mÃ´ hÃ¬nh Deep Learning nÃ y. HÃ´m nay chÃºng ta sáº½ tÃ¬m hiá»ƒu cÃ¡ch CNN hoáº¡t Ä‘á»™ng. Náº¿u nhÆ° sau bÃ i viáº¿t trÆ°á»›c cÃ¡c báº¡n cÃ³ Ä‘i tÃ¬m hiá»ƒu vá» â€œconvolutionâ€ (tÃ­ch cháº­p) lÃ  gÃ¬ thÃ¬ vá»›i nhá»¯ng ai Ä‘Ã£ â€œquÃªnâ€ háº§u háº¿t toÃ¡n sáº½ cáº£m tháº¥y vÃ´ cÃ¹ng tuyá»‡t vá»ng, báº£n thÃ¢n tÃ´i cÅ©ng cáº£m tháº¥y nhÆ° váº­y trong láº§n Ä‘áº§u má»Ÿ ná»™i dung vá» convolution trÃªn wiki ra Ä‘á»c. Tuy nhiÃªn náº¿u Ä‘Ã£ tÃ¬m hiá»ƒu, báº¡n sáº½ tháº¥y Ä‘á»ƒ hiá»ƒu tÃ­ch cháº­p, ta pháº£i biáº¿t tÃ­ch phÃ¢n lÃ  gÃ¬ Ä‘Ã£ ğŸ™‚

## 1. Integral (TÃ­ch phÃ¢n):

NhÆ° trong nhá»¯ng bÃ i viáº¿t Ä‘áº§u tiÃªn, ta Ä‘Ã£ hiá»ƒu tháº¿ nÃ o lÃ  slope hay gradient cá»§a má»™t Ä‘oáº¡n tháº³ng, tá»« Ä‘Ã³ phÃ¡t triá»ƒn lÃªn Ä‘áº¡o hÃ m cá»§a hÃ m sá»‘ táº¡i má»™t Ä‘iá»ƒm. Váº­y lÃ  tá»« má»™t hÃ m sá»‘ f(x) cho trÆ°á»›c ta cÃ³ thá»ƒ quan sÃ¡t Ä‘Æ°á»£c xu hÆ°á»›ng tÄƒng hay giáº£m cá»§a nÃ³ thÃ´ng qua viá»‡c tÄƒng hay giáº£m x. BÃ¢y giá» cÃ¢u há»i Ä‘áº·t ra lÃ  náº¿u ta cÃ³ Ä‘áº¡o hÃ m cá»§a hÃ m sá»‘ f(x) táº¡i x liá»‡u ta cÃ³ thá»ƒ quan sÃ¡t Ä‘Æ°á»£c f(x) hay khÃ´ng ? NÃ³i má»™t cÃ¡ch khÃ¡c lÃ  khi ta biáº¿t Ä‘á»™ dá»‘c cá»§a f(x) táº¡i cÃ¡c Ä‘iá»ƒm, liá»‡u ta cÃ³ thá»ƒ tÃ¬m Ä‘Æ°á»£c giÃ¡ trá»‹ cá»§a f(x) hay cáº£ hÃ m sá»‘ f(x) khÃ´ng ? 

<img src="/assets/content_images/ml19-01.png" alt = "" width = "100%">

ChÃº Ã½ ráº±ng, Ä‘áº¡o hÃ m táº¡i má»™t Ä‘iá»ƒm chÃ­nh lÃ  tá»‰ sá»‘ giá»¯a thay Ä‘á»•i vÃ´ cÃ¹ng nhá» trÃªn trá»¥c y vÃ  thay Ä‘á»•i vÃ´ cÃ¹ng nhá» trÃªn trá»¥c x. NhÆ° á»Ÿ hÃ m sá»‘ trÃªn, ta cÃ³ thá»ƒ dá»… dÃ ng hÃ¬nh dung nÃ³ lÃ  má»™t hÃ m báº­c 2 nÃªn Ä‘áº¡o hÃ m sáº½ lÃ  hÃ m báº­c 1 hay tuyáº¿n tÃ­nh â€“ má»™t Ä‘Æ°á»ng tháº³ng: 

<img src="/assets/content_images/ml19-02.png" alt = "" width = "100%">

Náº¿u giáº£ sá»­ ráº±ng \(âˆ†x â‰ˆ 0\), khi Ä‘Ã³ nÃ³ lÃ  khoáº£ng cÃ¡ch giá»¯a 2 Ä‘iá»ƒm liÃªn tiáº¿p trÃªn Ä‘á»“ thá»‹. Ta cÃ³ Ä‘áº¡o hÃ m táº¥t cáº£ cÃ¡c Ä‘iá»ƒm trÃªn Ä‘á»“ thá»‹ cá»§a cá»§a hÃ m sá»‘ f(x) nhÆ° sau: (Ta báº¯t Ä‘áº§u tá»« \\(x=a\\) vÃ  káº¿t thÃºc á»Ÿ \\(x=b\\))

$$
\begin{align*}
f'(a) 
& = \frac{[f(a + âˆ†x) \space â€“ \space f(a)]}{âˆ†x} \\
f'(a + âˆ†x) 
& = \frac{[f(a + 2âˆ†x) \space â€“ \space f(a + âˆ†x)]}{âˆ†x} \\
f'(a + 2âˆ†x)
& = \frac{[f(a + 3âˆ†x) \space â€“ \space f(a + 2âˆ†x)]}{âˆ†x} \\
f'(a + 3âˆ†x)
& = \frac{[f(a + 4âˆ†x) \space â€“ \space f(a + 3âˆ†x)]}{âˆ†x} \\
& â€¦. \\
f'(a + (b-a)/âˆ†x * âˆ†x)
& = \frac{[f(a + (\frac{b-a}{âˆ†x} + 1)âˆ†x) \space â€“ \space f(a + \frac{b-a}{âˆ†x}âˆ†x)]}{âˆ†x}
\end{align*}
$$

Äá»ƒ Ã½ ráº±ng náº¿u ta cá»™ng láº§n lÆ°á»£t tÆ°Æ¡ng á»©ng váº¿ trÃ¡i vá»›i váº¿ trÃ¡i vÃ  váº¿ pháº£i vá»›i váº¿ pháº£i ta sáº½ cÃ³: 

$$
\begin{align*}

\sum _{i=1} ^{m} f'(x + i \Delta x)
& = \frac{f(a + (\frac{b-a}{\Delta x} + 1) \Delta x) - f(a)}{\Delta x}
\\
& = \frac{f(b+ \Delta x) - f(a)}{\Delta x}
\\
& \approx \frac{f(b) - f(a)}{\Delta x} 
\\
=> \sum _{i=1} ^{m} f'(x + i \Delta x) \Delta x 
& = f(b) - f(a)

\end{align*}
$$

Káº¿t quáº£ cuá»‘i cÃ¹ng, váº¿ trÃ¡i á»Ÿ biá»ƒu thá»©c trÃªn ráº¥t quen thuá»™c, nÃ³ chÃ­nh lÃ  tÃ­ch phÃ¢n mÃ  chÃºng ta pháº£i váº­t lá»™n trong nhá»¯ng nÄƒm thÃ¡ng thi Ä‘áº¡i há»c Ä‘Ã³. Dáº¥u \\(âˆ«\\) trong tÃ­ch phÃ¢n chÃ­nh lÃ  Ä‘áº¡i diá»‡n cho dáº¥u \\(\sum\\) khi sá»‘ lÆ°á»£ng sá»‘ háº¡ng trong tá»•ng lÃ  vÃ´ háº¡n á»©ng vá»›i trÆ°á»ng há»£p hÃ m sá»‘ liÃªn tá»¥c. CÃ²n \\(âˆ†x\\) chÃ­nh lÃ  Ä‘áº¡i diá»‡n cho \\(dx\\) (viáº¿t táº¯t cho differential x â€“ vi phÃ¢n trÃªn x hay thay Ä‘á»•i vÃ´ cÃ¹ng nhá» trÃªn trá»¥c x). Thay 2 kÃ­ hiá»‡u ta vá»«a nháº¯c tá»›i vÃ o, ta Ä‘Æ°á»£c cÃ´ng thá»©c cá»§a tÃ­ch phÃ¢n ğŸ™‚ 

$$ => \int _{a} ^{b} f'(x)dx = f(b) - f(a) = f(x) \Big | _{a}^{b} $$

Váº­y tÃ­ch phÃ¢n, chÃ­nh lÃ  tá»•ng Ä‘áº¡o hÃ m cá»§a táº¥t cáº£ cÃ¡c Ä‘iá»ƒm náº±m trÃªn khoáº£ng chÃºng ta cÃ³ Ä‘áº¡o hÃ m. Náº¿u nhÆ° ta cÃ³ giÃ¡ trá»‹ cá»§a má»™t Ä‘iá»ƒm báº¯t Ä‘áº§u \\(f(a)\\), ta cÃ³ thá»ƒ tÃ¬m Ä‘Æ°á»£c giÃ¡ trá»‹ \\(f(b)\\) báº¥t kÃ¬ chá»‰ vá»›i Ä‘áº¡o hÃ m biáº¿t trÆ°á»›c.

## 2. Integral in statistic:

Trong thá»‘ng kÃª, khi pháº£i lÃ m viá»‡c vá»›i cÃ¡c giÃ¡ trá»‹ liÃªn tá»¥c ta cÅ©ng sá»­ dá»¥ng tÃ­ch phÃ¢n thay tháº¿ cho tá»•ng thÃ´ng thÆ°á»ng. Cháº³ng háº¡n khi cÃ¡c giÃ¡ trá»‹ lÃ  giÃ¡n Ä‘oáº¡n nhÆ°: Tung xÃºc xáº¯c 100 láº§n ta Ä‘Æ°á»£c 20 láº§n 1, 22 láº§n 2, 15 láº§n 3, 16 láº§n 4, 12 láº§n 5, 15 láº§n 6. Váº­y trung bÃ¬nh ta sáº½ tung xÃºc sáº¯c Ä‘Æ°á»£c:
\\((20 * 1 + 22 * 2 + 15 * 3 + 16 * 4 + 12 * 5 + 15 * 6) / 100 = 323/100 = 3.23\\)\\
Ta viáº¿t gá»n láº¡i: \\(\sum x_k * p_k = 3.23\\)
Trong Ä‘Ã³: \\(x_k\\) lÃ  cÃ¡c giÃ¡ trá»‹ trÃªn máº·t xÃºc sáº¯c {1,2,3,4,5,6}, cÃ²n \\(p_k\\) lÃ  xÃ¡c xuáº¥t rÆ¡i vÃ o cÃ¡c máº·t Ä‘Æ°á»£c tÃ­nh trÃªn sá»‘ láº§n rÆ¡i vÃ o cÃ¡c máº·t trÃªn tá»•ng sá»‘ láº§n rÆ¡i (cháº³ng háº¡n máº·t 1 cÃ³ 20 láº§n rÆ¡i thÃ¬ xÃ¡c suáº¥t = 20/100 = 0.2).
Khi giÃ¡ trá»‹ cá»§a \\(x\\) khÃ´ng cÃ²n lÃ  cÃ¡c giÃ¡ trá»‹ giÃ¡n Ä‘oáº¡n nhÆ° trÃªn máº·t xÃºc sáº¯c, giÃ¡ trá»‹ trung bÃ¬nh cá»§a cÃ¡c \\(x\\) (hay mean cá»§a x hay E(x)) lÃ  tÃ­ch phÃ¢n:
\\(\int xf(x)d(x)\\) trong Ä‘Ã³ \\(f(x)\\) lÃ  hÃ m máº­t Ä‘á»™ xÃ¡c suáº¥t (\\(p(x) = f(x) * dx\\) trong Ä‘Ã³ \\(dx\\) ráº¥t nhá» cÃ²n \\(f(x)\\) mÃ´ táº£ xÃ¡c suáº¥t cá»§a má»™t \\(x\\) báº¥t kÃ¬ trong khoáº£ng \\(dx\\)).

## 3. What is convolution:

Tá»›i Ä‘Ã¢y cÃ¡c báº¡n Ä‘Ã£ cÃ³ khÃ¡i niá»‡m vá» tÃ­ch phÃ¢n. Ta Ä‘Ã£ cÃ³ thá»ƒ hiá»ƒu convolution lÃ  gÃ¬ vÃ  Ã½ nghÄ©a cá»§a nÃ³ trong ML nhÆ° tháº¿ nÃ o. TrÃªn wiki tÃ­ch cháº­p cá»§a 2 hÃ m sá»‘ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a nhÆ° sau: 

<img src="/assets/content_images/ml19-03.png" alt = "" width = "100%">

NhÃ¬n vÃ o cÃ´ng thá»©c trÃªn cÃ¡c báº¡n sáº½ khÃ¡ â€¦ â€œhoang mangâ€. TÃ´i sáº½ giáº£i thÃ­ch tá»«ng thÃ nh pháº§n trong cÃ´ng thá»©c trÃªn:
\\(ğœ\\) : chÃ­nh lÃ  biáº¿n \\(x\\), biáº¿n sá»‘ mÃ  ta sáº½ quan sÃ¡t sá»± thay Ä‘á»•i hÃ m sá»‘ khi \\(ğœ\\) thay Ä‘á»•i vÃ´ cÃ¹ng nhá» dğœ.
\\(t\\) : Ä‘Ã¢y lÃ  má»™t biáº¿n sá»‘ khÃ¡c, trong Ä‘Ã³ \\(f(ğœ)\\) Ä‘á»©ng im cÃ²n \\(g(t-ğœ)\\) dá»‹ch má»™t khoáº£ng \\(t\\) vÃ  bá»‹ láº­t ngÆ°á»£c láº¡i, Ä‘á»‘i xá»©ng qua trá»¥c \\(y\\). NghÄ©a lÃ  vá»›i má»—i \\(t\\) ta sáº½ cÃ³ má»™t hÃ m \\(g(t-ğœ)\\) khÃ¡c nhau cÃ³ vá»‹ trá»‹ Ä‘á»‘i xá»©ng vÃ  lá»‡ch Ä‘i \\(t\\) so vá»›i hÃ m \\(g(ğœ)\\) ban Ä‘áº§u.
\\(f(ğœ) * g(t-ğœ)\\) : táº¡i má»—i t, ta tÃ­nh tá»•ng cá»§a táº¥t cáº£ f vÃ  g táº¡i tá»«ng \\(ğœ\\).
Váº«n hÆ¡i Ä‘au Ä‘áº§u pháº£i khÃ´ng ? Giá» náº¿u báº¡n nhÃ¬n lÃªn pháº§n tÃ­ch phÃ¢n trong thá»‘ng kÃª bÃªn trÃªn, báº¡n sáº½ tháº¥y tÃ­ch cháº­p nhÃ¬n ráº¥t giá»‘ng \\(\int x \space f(x)d(x)\\) trong Ä‘Ã³ \\(f(ğœ)\\) mÃ´ táº£ \\(x\\) cÃ²n \\(g(t-ğœ)\\) mÃ´ táº£ xÃ¡c suáº¥t cá»§a \\(x\\). Váº­y cÃ³ nghÄ©a lÃ  náº¿u Ä‘á»©ng tá»« máº·t thá»‘ng kÃª tÃ­ch cháº­p cháº³ng qua Mean hay Expectation cá»§a biáº¿n ngáº«u nhiÃªn vá»›i hÃ m phÃ¢n phá»‘i xÃ¡c suáº¥t Ä‘Ã£ biáº¿t.

## 4. Intuition of convolution:

Äá»ƒ cÃ¡c báº¡n dá»… hiá»ƒu hÆ¡n, tÃ´i sáº½ giáº£i thÃ­ch trÃªn má»™t vÃ­ dá»¥:
Giáº£ sá»­ ta cÃ³ hÃ m sá»‘ \\(\mathbf{f(x)}\\) mÃ´ táº£ vá»‹ trÃ­ cá»§a má»™t ngÆ°á»i dá»±a trÃªn thiáº¿t bá»‹ GPS ngÆ°á»i Ä‘Ã³ mang theo (Äá»ƒ cho Ä‘Æ¡n giáº£n, ta sáº½ chá»‰ thu tháº­p kinh Ä‘á»™ cá»§a ngÆ°á»i Ä‘Ã³). Tuy nhiÃªn trÃªn thá»±c táº¿, cÃ¡c thiáº¿t bá»‹ GPS hoáº¡t Ä‘á»™ng khÃ´ng chÃ­nh xÃ¡c 100%, Ä‘Ã´i khi cÃ³ nhiá»…u, nghÄ©a lÃ  dÃ¹ ta Ä‘á»©ng yÃªn, toáº¡ Ä‘á»™ cá»§a ta váº«n cÃ³ thá»ƒ thay Ä‘á»•i. ChÃ­nh vÃ¬ váº­y thay vÃ¬ táº¡o ra má»™t thiáº¿t bá»‹ chÃ­nh xÃ¡c hÆ¡n, ta cÃ³ tháº¿ Æ°á»›c tÃ­nh vá»‹ trá»‹ hiá»‡n táº¡i thÃ´ng qua táº¥t cáº£ cÃ¡c vá»‹ trÃ­. CÅ©ng giá»‘ng nhÆ° trÃªn, táº¡i má»—i \\(\mathbf{f(x)}\\) ta táº¡o ra má»™t \\(\mathbf{w(t-x)}\\) (\\(w\\) Ä‘áº¡i diá»‡n cho weight) Ä‘á»ƒ chá»‰ trá»ng sá»‘ cá»§a vá»‹ trÃ­ Ä‘Ã³ (táº¡i má»—i thá»i Ä‘iá»ƒm \\(t\\), hÃ m trá»ng sá»‘ cá»§a ta sáº½ khÃ¡c nhau), \\(\mathbf{w(t-x)}\\) cao tá»©c xÃ¡c suáº¥t táº¡i thá»i Ä‘iá»ƒm \\(t\\) vá»‹ trÃ­ \\(x\\) cÃ³ Ä‘á»™ chÃ­nh xÃ¡c cao, Ä‘á»™ tin cáº­y cao. Khi tÃ­nh giÃ¡ trá»‹ trung bÃ¬nh cá»§a táº¥t cáº£ cÃ¡c \\(\mathbf{f(x) \space w(t-x)\\) ta Ä‘Æ°á»£c vá»‹ trá»‹ cáº§n Æ°á»›c lÆ°á»£ng. NhÆ°ng khi \\(x\\) lÃ  liÃªn tá»¥c thÃ¬ ta cáº§n sá»­ dá»¥ng Ä‘áº¿n tÃ­ch phÃ¢n. Hay Ä‘á»ƒ Æ°á»›c lÆ°á»£ng ta sá»­ dá»¥ng tÃ­ch cháº­p. VÃ¬ hÃ m trá»ng sá»‘ \\(w\\) cÅ©ng cÃ³ giÃ¡ trá»‹ cao táº¡i nhá»¯ng \\(f(x)\\) Ä‘Ã¡ng tin cáº­y nÃªn \\(w\\) sáº½ pháº£i tÆ°Æ¡ng quan vá»›i vá»›i cÃ¡c vá»‹ trÃ­ chÃ­nh xÃ¡c (\\(w\\) vÃ  xÃ¡c suáº¥t vá»‹ trÃ­ \\(x\\) lÃ  chÃ­nh xÃ¡c pháº£i cÃ¹ng lá»›n hoáº·c cÃ¹ng nhá»).
Ta cÃ³ thá»ƒ hiá»ƒu Ã½ tÆ°á»Ÿng cá»§a convolution lÃ  sá»­ dá»¥ng má»™t hÃ m trá»ng sá»‘ Ä‘á»ƒ Ä‘Ã¡nh dáº¥u cÃ¡c giÃ¡ trá»‹ quan trá»ng (giÃ¡ trá»‹ Æ°á»›c lÆ°á»£ng bÃªn trÃªn), hoáº·c Ä‘á»ƒ tÃ¬m kiáº¿m cÃ¡c vá»‹ trÃ­ tÆ°Æ¡ng quan cá»§a 2 hÃ m sá»‘ (cÃ¡c \\(t\\) mÃ  2 hÃ m sá»‘ tÆ°Æ¡ng Ä‘Æ°Æ¡ng nhau). NhÆ° cÃ¡c báº¡n tháº¥y trÃªn wiki: 

<img src="/assets/content_images/ml19-04.gif" alt = "" width = "70%">

TÃ´i tháº¥y trÃªn hÃ¬nh váº½ nÃ y cá»§a wiki cÃ³ chÃº thÃ­ch pháº§n mÃ u vÃ ng lÃ  diá»‡n tÃ­ch dÆ°á»›i \\(\mathbf{f(ğœ)g(t-ğœ)}\\) khÃ´ng sai nhÆ°ng báº£n thÃ¢n pháº§n mÃ u vÃ ng láº¡i trÃ´ng nhÆ° Ä‘ang mÃ´ táº£ diá»‡n tÃ­ch pháº§n giao nhau giá»¯a 2 hÃ m sá»‘. NÃªn cÃ¡c báº¡n cáº§n phÃ¢n biá»‡t rÃµ, pháº§n mÃ u vÃ ng lÃ  tá»•ng cá»§a cÃ¡c f(ğœ)g(t-ğœ) khÃ´ng pháº£i lÃ  diá»‡n tÃ­ch pháº§n giao nhau.
Äáº¿n Ä‘Ã¢y hi vá»ng cÃ¡c báº¡n Ä‘Ã£ mÃ¹ má» vá» convolution (tÃ­ch cháº­p) lÃ  gÃ¬, trong bÃ i viáº¿t sau ta sáº½ cÃ¹ng nhau tÃ¬m hiá»ƒu xem convolution trong ML hay máº¡ng neural. Háº¹n gáº·p láº¡i cÃ¡c báº¡n trong bÃ i viáº¿t sau.